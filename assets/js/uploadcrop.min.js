$.fn.uploadCrop=function(o){function i(o){$(n).html("").append(c),$('<div id="slider"></div>').appendTo(l),$("#"+s).prop("src",o.target.result.toString()).hide(),$(h).prop("disabled",!1),$(v).prop("disabled",!1),$(m).prop("disabled",!1),$(f).prop("disabled",!1),$("#"+s+"_button_accept").off("click"),$("#"+s+"_button_cancel").off("click"),$(u).off("shown.bs.modal"),$("#"+s+"_button_accept").on("click",function(){var o=$("#"+s).cropper("getDataURL");if(""==o){var i=$("#"+s).cropper("getImageData");$(h).val("0"),$(v).val(i.naturalWidth),$(m).val("0"),$(f).val(i.naturalHeight),g.prop("src",$("#"+s).prop("src")).show()}else g.prop("src",o).show();$("#"+p).submit(),$(n).html(""),$(u).modal("hide")}),$("#"+s+"_button_cancel").on("click",function(){$(r).val(""),g.hide(),$(n).html(""),$(h).val(""),$(v).val(""),$(m).val(""),$(f).val(""),$(h).prop("disabled",!0),$(v).prop("disabled",!0),$(m).prop("disabled",!0),$(f).prop("disabled",!0),$(u).modal("hide")}),$(u).on("shown.bs.modal",function(o){$(n).width()>$("#"+s).width()&&$(n).css({width:$("#"+s).width()+"px"}),t.crop=function(){var o=$(this).cropper("getData");$(h).val(o.x),$(v).val(o.width),$(m).val(o.y),$(f).val(o.height)},t.cropend=function(){var o=$(this).cropper("getData");$(h).val(o.x),$(v).val(o.width),$(m).val(o.y),$(f).val(o.height)},t.zoom=function(){var o=$(this).cropper("getData");$(h).val(o.x),$(v).val(o.width),$(m).val(o.y),$(f).val(o.height)},t.built=function(){$("#"+s).cropper("reset"),$(u).modal("adjustBackdrop")},$("#"+s).cropper(t),$("#zoom-in").click(function(){console.log("zoom-in"),$("#"+s).cropper("zoom",.1)}),$("#zoom-out").click(function(){console.log("zoom-out"),$("#"+s).cropper("zoom",-.1)}),$(".spinner").hide()}),$(u).modal("show")}var a=o.inputField,t=o.jcropOptions,e=o.sizemax,p=o.formId,r=$(this),d=$(this).parents(".uploadcrop"),n=$(d).find("div#image-source"),l=$(d).find("div.modal-body"),c=$(n).find("img").prop("outerHTML"),s=$(n).find("img").attr("id"),h=$("#"+a+"-x"),v=$("#"+a+"-width"),m=$("#"+a+"-y"),f=$("#"+a+"-height"),u=$(d).find("div.modal"),g=$(d).find("#preview-pane div.preview-container img.preview_image");g.css("maxWidth",e+"px").css("maxHeight",e+"px").hide(),r.change(function(o){$(".spinner").show();var a=o.target.files[0],t=/image.*/;if(a.type.match(t)){var e=new FileReader;e.onload=i,e.readAsDataURL(a)}})};